# توثيق واجهة برمجة التطبيقات (API) لنظام العقارات
## جدول المحتويات

1. [المصادقة](#المصادقة)
2. [العقارات العامة](#العقارات-العامة)
   - [عرض قائمة العقارات](#عرض-قائمة-العقارات)
   - [عرض تفاصيل عقار محدد](#عرض-تفاصيل-عقار-محدد)
3. [إدارة العقارات](#إدارة-العقارات)
   - [إنشاء عقار جديد](#إنشاء-عقار-جديد)
   - [تحديث عقار](#تحديث-عقار)
   - [حذف عقار](#حذف-عقار)
   - [تعديل حالة العقار](#تعديل-حالة-العقار)

## المصادقة

جميع طلبات واجهة برمجة التطبيقات (API) الخاصة بإدارة العقارات تتطلب مصادقة باستخدام رمز الوصول (Bearer Token). يجب إرسال رمز الوصول في ترويسة الطلب كما يلي:

```
Authorization: Bearer {token}
```

للحصول على رمز الوصول، يجب على المستخدم تسجيل الدخول أولاً. راجع [توثيق واجهة برمجة التطبيقات للمصادقة](auth_api_documentation.md) للحصول على مزيد من المعلومات.

## العقارات العامة

### عرض قائمة العقارات

يعرض قائمة بالعقارات المتاحة مع إمكانية التصفية والبحث.

- **URL**: `/api/properties`
- **Method**: `GET`
- **المصادقة**: اختيارية
- **معلمات الاستعلام**:
  - `type`: نوع العقار (بيع، إيجار، مزاد)
  - `location`: الموقع
  - `min_price`: الحد الأدنى للسعر
  - `max_price`: الحد الأقصى للسعر
  - `min_rooms`: الحد الأدنى لعدد الغرف
  - `max_rooms`: الحد الأقصى لعدد الغرف
  - `min_area`: الحد الأدنى للمساحة
  - `max_area`: الحد الأقصى للمساحة
  - `page`: رقم الصفحة (للتصفح الصفحي)

#### استجابة ناجحة (200 OK)

```json
{
  "data": [
    {
      "id": 1,
      "title": "شقة فاخرة في وسط المدينة",
      "description": "شقة حديثة مع إطلالة رائعة",
      "price": 500000,
      "type": "sale",
      "location": "الرياض",
      "address": "حي الملز، شارع الأمير ماجد",
      "floor_number": 3,
      "rooms": 3,
      "bathrooms": 2,
      "area": 150,
      "additional_conditions": ["مكيف", "مطبخ مجهز", "موقف سيارات"],
      "status": "active",
      "is_available": true,
      "is_available_by_admin": true,
      "user_id": 1,
      "created_at": "2023-06-15T10:30:00.000000Z",
      "updated_at": "2023-06-15T10:30:00.000000Z",
      "images": [
        {
          "id": 1,
          "property_id": 1,
          "image_path": "properties/property1_image1.jpg",
          "created_at": "2023-06-15T10:30:00.000000Z",
          "updated_at": "2023-06-15T10:30:00.000000Z"
        }
      ],
      "user": {
        "id": 1,
        "name": "أحمد محمد",
        "email": "ahmed@example.com"
      }
    }
  ],
  "links": {
    "first": "http://example.com/api/properties?page=1",
    "last": "http://example.com/api/properties?page=5",
    "prev": null,
    "next": "http://example.com/api/properties?page=2"
  },
  "meta": {
    "current_page": 1,
    "from": 1,
    "last_page": 5,
    "path": "http://example.com/api/properties",
    "per_page": 15,
    "to": 15,
    "total": 75
  }
}
```

### عرض تفاصيل عقار محدد

يعرض تفاصيل عقار محدد بواسطة المعرف الخاص به.

- **URL**: `/api/properties/{id}`
- **Method**: `GET`
- **المصادقة**: اختيارية
- **المعلمات المسار**: 
  - `id`: معرف العقار

#### استجابة ناجحة (200 OK)

```json
{
  "id": 1,
  "title": "شقة فاخرة في وسط المدينة",
  "description": "شقة حديثة مع إطلالة رائعة",
  "price": 500000,
  "type": "sale",
  "location": "الرياض",
  "address": "حي الملز، شارع الأمير ماجد",
  "floor_number": 3,
  "rooms": 3,
  "bathrooms": 2,
  "area": 150,
  "additional_conditions": ["مكيف", "مطبخ مجهز", "موقف سيارات"],
  "status": "active",
  "is_available": true,
  "is_available_by_admin": true,
  "user_id": 1,
  "created_at": "2023-06-15T10:30:00.000000Z",
  "updated_at": "2023-06-15T10:30:00.000000Z",
  "images": [
    {
      "id": 1,
      "property_id": 1,
      "image_path": "properties/property1_image1.jpg",
      "created_at": "2023-06-15T10:30:00.000000Z",
      "updated_at": "2023-06-15T10:30:00.000000Z"
    }
  ],
  "user": {
    "id": 1,
    "name": "أحمد محمد",
    "email": "ahmed@example.com"
  }
}
```

#### استجابة خطأ (404 Not Found)

```json
{
  "message": "العقار غير موجود"
}
```

## إدارة العقارات

### إنشاء عقار جديد

ينشئ عقارًا جديدًا.

- **URL**: `/api/properties`
- **Method**: `POST`
- **المصادقة**: مطلوبة
- **نوع المحتوى**: `multipart/form-data`
- **معلمات الطلب**:
  - `title`: عنوان العقار (مطلوب، نص، الحد الأقصى 255 حرف)
  - `description`: وصف العقار (مطلوب، نص)
  - `price`: سعر العقار (مطلوب، رقم، الحد الأدنى 0)
  - `type`: نوع العقار (مطلوب، يجب أن يكون أحد القيم: sale, rent, auction)
  - `location`: موقع العقار (مطلوب، نص، الحد الأقصى 255 حرف)
  - `address`: عنوان العقار (مطلوب، نص، الحد الأقصى 255 حرف)
  - `floor_number`: رقم الطابق (اختياري، عدد صحيح، الحد الأدنى 0)
  - `rooms`: عدد الغرف (مطلوب، عدد صحيح، الحد الأدنى 1)
  - `bathrooms`: عدد الحمامات (مطلوب، عدد صحيح، الحد الأدنى 1)
  - `area`: مساحة العقار (مطلوب، رقم، الحد الأدنى 1)
  - `additional_conditions`: شروط إضافية (اختياري، مصفوفة)
  - `images`: صور العقار (مطلوب، مصفوفة، الحد الأدنى 1)
  - `images.*`: ملفات الصور (يجب أن تكون بتنسيق jpeg, png, jpg، الحد الأقصى 2048 كيلوبايت)

#### استجابة ناجحة (201 Created)

```json
{
  "message": "تم إنشاء العقار بنجاح",
  "property": {
    "id": 1,
    "title": "شقة فاخرة في وسط المدينة",
    "description": "شقة حديثة مع إطلالة رائعة",
    "price": 500000,
    "type": "sale",
    "location": "الرياض",
    "address": "حي الملز، شارع الأمير ماجد",
    "floor_number": 3,
    "rooms": 3,
    "bathrooms": 2,
    "area": 150,
    "additional_conditions": ["مكيف", "مطبخ مجهز", "موقف سيارات"],
    "status": "active",
    "is_available": true,
    "is_available_by_admin": true,
    "user_id": 1,
    "created_at": "2023-06-15T10:30:00.000000Z",
    "updated_at": "2023-06-15T10:30:00.000000Z",
    "images": [
      {
        "id": 1,
        "property_id": 1,
        "image_path": "properties/property1_image1.jpg",
        "created_at": "2023-06-15T10:30:00.000000Z",
        "updated_at": "2023-06-15T10:30:00.000000Z"
      }
    ]
  }
}
```

#### استجابة خطأ (422 Unprocessable Entity)

```json
{
  "errors": {
    "title": ["حقل العنوان مطلوب"],
    "price": ["يجب أن يكون السعر رقمًا موجبًا"],
    "images": ["يجب إرفاق صورة واحدة على الأقل"]
  }
}
```

### تحديث عقار

يقوم بتحديث بيانات عقار موجود.

- **URL**: `/api/properties/{id}`
- **Method**: `PUT` أو `PATCH`
- **المصادقة**: مطلوبة (يجب أن يكون المستخدم مالك العقار أو مشرف)
- **نوع المحتوى**: `multipart/form-data`
- **المعلمات المسار**: 
  - `id`: معرف العقار
- **معلمات الطلب**:
  - `title`: عنوان العقار (اختياري، نص، الحد الأقصى 255 حرف)
  - `description`: وصف العقار (اختياري، نص)
  - `price`: سعر العقار (اختياري، رقم، الحد الأدنى 0)
  - `type`: نوع العقار (اختياري، يجب أن يكون أحد القيم: sale, rent, auction)
  - `location`: موقع العقار (اختياري، نص، الحد الأقصى 255 حرف)
  - `address`: عنوان العقار (اختياري، نص، الحد الأقصى 255 حرف)
  - `floor_number`: رقم الطابق (اختياري، عدد صحيح، الحد الأدنى 0)
  - `rooms`: عدد الغرف (اختياري، عدد صحيح، الحد الأدنى 1)
  - `bathrooms`: عدد الحمامات (اختياري، عدد صحيح، الحد الأدنى 1)
  - `area`: مساحة العقار (اختياري، رقم، الحد الأدنى 1)
  - `additional_conditions`: شروط إضافية (اختياري، مصفوفة)
  - `new_images`: صور جديدة للعقار (اختياري، مصفوفة)
  - `new_images.*`: ملفات الصور الجديدة (يجب أن تكون بتنسيق jpeg, png, jpg، الحد الأقصى 2048 كيلوبايت)
  - `delete_images`: معرفات الصور المراد حذفها (اختياري، مصفوفة)
  - `delete_images.*`: معرفات الصور الموجودة
  - `status`: حالة العقار (اختياري، يجب أن تكون أحد القيم: active, inactive, pending, sold, rented)

#### استجابة ناجحة (200 OK)

```json
{
  "message": "تم تحديث العقار بنجاح",
  "property": {
    "id": 1,
    "title": "شقة فاخرة في وسط المدينة (محدث)",
    "description": "شقة حديثة مع إطلالة رائعة وتشطيبات فاخرة",
    "price": 550000,
    "type": "sale",
    "location": "الرياض",
    "address": "حي الملز، شارع الأمير ماجد",
    "floor_number": 3,
    "rooms": 3,
    "bathrooms": 2,
    "area": 150,
    "additional_conditions": ["مكيف", "مطبخ مجهز", "موقف سيارات", "حديقة خاصة"],
    "status": "active",
    "is_available": true,
    "is_available_by_admin": true,
    "user_id": 1,
    "created_at": "2023-06-15T10:30:00.000000Z",
    "updated_at": "2023-06-16T14:45:00.000000Z",
    "images": [
      {
        "id": 1,
        "property_id": 1,
        "image_path": "properties/property1_image1.jpg",
        "created_at": "2023-06-15T10:30:00.000000Z",
        "updated_at": "2023-06-15T10:30:00.000000Z"
      },
      {
        "id": 3,
        "property_id": 1,
        "image_path": "properties/property1_image3.jpg",
        "created_at": "2023-06-16T14:45:00.000000Z",
        "updated_at": "2023-06-16T14:45:00.000000Z"
      }
    ]
  }
}
```

#### استجابة خطأ (403 Forbidden)

```json
{
  "message": "غير مصرح لك بتعديل هذا العقار"
}
```

#### استجابة خطأ (404 Not Found)

```json
{
  "message": "العقار غير موجود"
}
```

#### استجابة خطأ (422 Unprocessable Entity)

```json
{
  "errors": {
    "price": ["يجب أن يكون السعر رقمًا موجبًا"],
    "new_images.0": ["يجب أن تكون الصورة بتنسيق jpeg, png, jpg"]
  }
}
```

### حذف عقار

يقوم بحذف عقار موجود.

- **URL**: `/api/properties/{id}`
- **Method**: `DELETE`
- **المصادقة**: مطلوبة (يجب أن يكون المستخدم مالك العقار أو مشرف)
- **المعلمات المسار**: 
  - `id`: معرف العقار

#### استجابة ناجحة (200 OK)

```json
{
  "message": "تم حذف العقار بنجاح"
}
```

#### استجابة خطأ (403 Forbidden)

```json
{
  "message": "غير مصرح لك بحذف هذا العقار"
}
```

#### استجابة خطأ (404 Not Found)

```json
{
  "message": "العقار غير موجود"
}
```

### تعديل حالة العقار

يقوم بتغيير حالة توفر العقار (تفعيل/تعطيل).

- **URL**: `/api/properties/{id}/availability`
- **Method**: `PATCH`
- **المصادقة**: مطلوبة (يجب أن يكون المستخدم مالك العقار أو مشرف)
- **المعلمات المسار**: 
  - `id`: معرف العقار

#### استجابة ناجحة (200 OK)

```json
{
  "message": "تم تحديث حالة العقار بنجاح",
  "property": {
    "id": 1,
    "title": "شقة فاخرة في وسط المدينة",
    "is_available": false,
    "is_available_by_admin": true,
    "user_id": 1,
    "created_at": "2023-06-15T10:30:00.000000Z",
    "updated_at": "2023-06-16T15:20:00.000000Z"
  }
}
```

#### استجابة خطأ (403 Forbidden)

```json
{
  "message": "غير مصرح لك بتعديل حالة هذا العقار"
}
```

#### استجابة خطأ (404 Not Found)

```json
{
  "message": "العقار غير موجود"
}
```

# توثيق واجهة برمجة التطبيقات (API) لنظام العقارات
## أنواع العقارات

- **sale**: عقار للبيع
- **rent**: عقار للإيجار
- **auction**: عقار للمزاد

## حالات العقارات

- **active**: عقار نشط ومتاح
- **inactive**: عقار غير نشط (معطل مؤقتًا)
- **pending**: عقار قيد المراجعة
- **sold**: عقار تم بيعه
- **rented**: عقار تم تأجيره